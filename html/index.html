<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="css/login.css" />
    <link rel="stylesheet" href="css/about.css" />
    <link rel="website icon" href="image/logo.png" />
    <title>login</title>
  </head>
  <body>
    <!-- navigation bar starts -->
    <main>
      <div class="nav-bar">
        <a href="index.html"><img src="image/logo.png" alt="japhet" /></a>
      </div>
    </main>
    <!-- navigation bar ends -->
    <!-- section part starts  -->
    <section>
      <div class="card">
        <div id="signup">
          <p>Don't have an account?</p>
          <a href="signup.html">sign up</a>
        </div>
        <div id="message">
          <i class="fa fa-exclamation-circle"></i>
        </div>
        <div id="login">
          <p>e-mail: <input type="text" name="name" id="input" /></p>
          <p>password: <input type="password" name="password" id="input" /></p>
          <button onclick="validateForm()">log in</button>
        </div>
      </div>
    </section>
    <!-- section part ends -->
    <!-- footer starts -->
    <footer>
      <div id="icons">
        <a href="https://github.com/rwamugema"> <i class="fa fa-github"></i></a>
        <a href="https://www.linkedin.com/in/rwamugema-japhet-84818b251/"
          ><i class="fa fa-linkedin"></i
        ></a>
        <a href="https://www.facebook.com/jet.japheth"
          ><i class="fa fa-facebook"></i
        ></a>
      </div>
      <hr />
      <div id="copy">
        <p>&copy /2022</p>
      </div>
    </footer>
    <!-- footer ends -->
    <!-- js validating the form  -->
    <script>
     async function validateForm() {
        var users = [];
        const user = {
          email: document.getElementsByName("name")[0].value,
          password: document.getElementsByName("password")[0].value,
        };
        let pattern = "/^[^ ]+@[^ ] +\.[a-z]{2,3}$/";
        // if (user.email === "") {
        //   message.style.display = "none";
        //   message.innerHTML = "";
        //   message.innerHTML = "username can not be empty";
        //   message.style.display = "block";
        // } else if (user.email.length < 4) {
        //   message.style.display = "block";
        //   message.innerHTML = "your username is short";
        // } else if (!user.password) {
        //   message.style.display = "none";
        //   message.innerHTML = "";
        //   message.innerHTML = "password can not be empty";
        //   message.style.display = "block";
        // } else if (user.password.length < 8) {
        //   message.style.display = "none";
        //   message.innerHTML = "";
        //   message.innerHTML = "password is weak try above 8 characters";
        //   message.style.display = "block";
        // }
        //  else {
    try {
      const response =  await fetch('https://naughty-jay-tank-top.cyclic.app/api/v1/login', {
    method: "POST",
    mode: "cors",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(user),
  })
  // console.log(resp);
  if (!response.ok) {
    message.style.display = "block"
    message.innerHTML = "invalid email or password"
  }else{
  const data = await response.json()
  const token = data
   localStorage.setItem('user',JSON.stringify(data))
   if(user.email ==='kylesjet1@gmail.com'){
    window.location.href = 'blogoverview.html'
   }else{
  window.location.href = 'landingpage.html'
   }
  
  }
    } catch (error) {
      message.style.display = 'block'
      message.innerHTML = 'invalid email or password'
    } 
        }
    </script>
  </body>
</html>
